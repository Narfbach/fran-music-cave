<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <title>Admin Panel - Fran's Music Cave</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            max-width: 1000px;
            margin: 100px auto 3rem;
            padding: 0 2rem;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #1a1a1a;
        }

        .admin-header h1 {
            font-size: 1.5rem;
            color: #666;
            letter-spacing: 5px;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            font-size: 0.75rem;
            color: #333;
            letter-spacing: 2px;
        }

        .submission-card {
            background: #000;
            border: 1px solid #1a1a1a;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: border-color 0.3s;
        }

        .submission-card:hover {
            border-color: #333;
        }

        .submission-info {
            margin-bottom: 1.5rem;
        }

        .submission-title {
            font-size: 1rem;
            color: #999;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .submission-artist {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }

        .submission-meta {
            font-size: 0.7rem;
            color: #444;
            letter-spacing: 1px;
        }

        .submission-url {
            font-size: 0.7rem;
            color: #333;
            word-break: break-all;
            margin-top: 0.5rem;
        }

        .submission-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-approve,
        .btn-reject {
            flex: 1;
            padding: 0.8rem;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            border: 1px solid #1a1a1a;
            background: transparent;
        }

        .btn-approve {
            color: #666;
        }

        .btn-approve:hover {
            border-color: #4ecdc4;
            color: #4ecdc4;
        }

        .btn-reject {
            color: #444;
        }

        .btn-reject:hover {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .no-submissions {
            text-align: center;
            padding: 4rem 2rem;
            color: #444;
            font-size: 0.9rem;
            letter-spacing: 2px;
        }

        .loading-admin {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
            font-size: 0.9rem;
            letter-spacing: 2px;
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 0 1rem;
                margin-top: 80px;
            }

            .submission-card {
                padding: 1.5rem;
            }

            .submission-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">ADMIN PANEL</div>
            <div class="header-subtitle"><a href="index.html" style="color: #333; text-decoration: none;">BACK TO SITE</a></div>
        </nav>
    </header>

    <div class="admin-container">
        <div class="admin-header">
            <h1>TRACK SUBMISSIONS</h1>
            <p>Review and approve user submissions</p>
        </div>

        <div id="submissionsContainer">
            <div class="loading-admin">Loading submissions...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, where, orderBy, onSnapshot, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDa5zahCZE7Gsh0JAkC1iimWutpBddRF1s",
            authDomain: "fran-music-cave.firebaseapp.com",
            projectId: "fran-music-cave",
            storageBucket: "fran-music-cave.firebasestorage.app",
            messagingSenderId: "518773964413",
            appId: "1:518773964413:web:46f3b94fb6db076c323b14",
            measurementId: "G-3NN8Q90FX8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const submissionsContainer = document.getElementById('submissionsContainer');

        // Formatear fecha
        function formatDate(timestamp) {
            if (!timestamp) return 'Just now';
            const date = timestamp.toDate();
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        // Renderizar submissions
        function renderSubmissions(submissions) {
            if (submissions.length === 0) {
                submissionsContainer.innerHTML = '<div class="no-submissions">No pending submissions</div>';
                return;
            }

            submissionsContainer.innerHTML = '';

            submissions.forEach(submission => {
                const card = document.createElement('div');
                card.className = 'submission-card';
                card.innerHTML = `
                    <div class="submission-info">
                        <div class="submission-title">${submission.title}</div>
                        <div class="submission-artist">${submission.artist}</div>
                        <div class="submission-meta">
                            Platform: ${submission.platform.toUpperCase()} |
                            Submitted by: ${submission.submittedBy} |
                            ${formatDate(submission.timestamp)}
                        </div>
                        <div class="submission-url">${submission.originalUrl}</div>
                    </div>
                    <div class="submission-actions">
                        <button class="btn-approve" onclick="approveSubmission('${submission.id}', '${submission.title}', '${submission.artist}', '${submission.platform}', '${submission.embedUrl}')">
                            Approve & Publish
                        </button>
                        <button class="btn-reject" onclick="rejectSubmission('${submission.id}')">
                            Reject
                        </button>
                    </div>
                `;
                submissionsContainer.appendChild(card);
            });
        }

        // Escuchar submissions en tiempo real
        const q = query(
            collection(db, 'submissions'),
            where('status', '==', 'pending'),
            orderBy('timestamp', 'desc')
        );

        onSnapshot(q, (snapshot) => {
            const submissions = [];
            snapshot.forEach((doc) => {
                submissions.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            renderSubmissions(submissions);
        });

        // Aprobar submission
        window.approveSubmission = async (id, title, artist, platform, embedUrl) => {
            if (!confirm(`Approve track: "${title}" by ${artist}?`)) return;

            try {
                // Aquí tendrías que actualizar el script.js manualmente
                // Por ahora solo marcamos como aprobado
                await updateDoc(doc(db, 'submissions', id), {
                    status: 'approved'
                });

                alert(`Track approved! You need to add it to script.js:\n\n{\n  title: "${title}",\n  artist: "${artist}",\n  platform: "${platform}",\n  embedUrl: "${embedUrl}"\n}`);

            } catch (error) {
                console.error('Error approving:', error);
                alert('Error approving track');
            }
        };

        // Rechazar submission
        window.rejectSubmission = async (id) => {
            if (!confirm('Reject this submission?')) return;

            try {
                await deleteDoc(doc(db, 'submissions', id));
                alert('Submission rejected');
            } catch (error) {
                console.error('Error rejecting:', error);
                alert('Error rejecting submission');
            }
        };
    </script>
</body>
</html>
